<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>J Mor's Pixel Life</title>
    <link href="https://fonts.googleapis.com/css?family=Press+Start+2P" rel="stylesheet" />
    <link href="styles/main.css" type="text/css" rel="stylesheet" />
    <script src="js/lifeworld.js"></script>
    <script src="js/main.js"></script>
</head>
<body>
    <div id="wrapper">
        <div id="gridContainer"></div>
        <div id="rhsContainer">
            <h1>Pixel Life</h1>
            <select id="colorChooser">
                <option value="red" selected>Red</option>
                <option value="white">White</option>
                <!--<option value="aqua">Aqua</option>
                <option value="Bisque">Bisque</option>
                <option value="black">Black</option>
                <option value="blue">Blue</option>
                <option value="brown">Brown</option>
                <option value="chocolate">Chocolate</option>
                <option value="cyan">Cyan</option>
                <option value="DarkGray">Dark Gray</option>
                <option value="green">Green</option>
                <option value="magenta">Magenta</option>
                <option value="orange">Orange</option>
                <option value="tan">Tan</option>
                <option value="wheat">Wheat</option>
                <option value="WhiteSmoke">WhiteSmoke </option>
                <option value="yellow">Yellow</option>-->
            </select>
            <div id="playBar">
                <button type="button" id="stepButton">Step</button>
                <button type="button" id="pauseButton">Play/Pause</button>
                <button type="button" id="reset">Reset</button>
                <div id="stepKeyDiv" class="keyBindContainer">
                    <button type="button" id="defineStepKey" class="keyBindBttn" data-step-key="KeyS">Press to define step key.</button>
                    <p id="stepKeyDisplay" class="keyBindDisp" data-step-key="KeyS">No Step Key Defined.</p>
                </div>
                <div id="pauseKeyDiv" class="keyBindContainer">
                    <button type="button" id="definePauseKey" class="keyBindBttn" data-pause-key="KeyP">Press to define pause key.</button>
                    <p id="pauseKeyDisplay" class="keyBindDisp" data-pause-key="KeyP">No Pause Key Defined.</p>
                </div>
                <div id="resetKeyDiv" class="keyBindContainer">
                    <button type="button" id="defineResetKey" class="keyBindBttn" data-reset-key="KeyR">Press to define reset key.</button>
                    <p id="resetKeyDisplay" class="keyBindDisp" data-reset-key="KeyR">No Reset Key Defined.</p>
                </div>
            </div>
            <p id="frameCounter">Steps Drawn: </p>
        </div>
    </div>
    <!--<script>
        const numCols = 70;
        const numRows = 40;
        const cellWidth = 10;
        const cellSpacing = 1;

        const container = document.querySelector("#gridContainer");

        const span = document.createElement('span');
        span.className = 'cell';

        const cells = [];

        for (var row = 0; row < numRows; row++) {
            cells.push([]);
            for (let col = 0; col < numCols; col++) {
                let cell = span.cloneNode();
                cell.style.left = `${col * (cellWidth + cellSpacing)}px`;
                cell.style.top = `${row * (cellWidth + cellSpacing)}px`;
                container.appendChild(cell);
                cells[row][col] = cell;
            }
        }

        let color = "red";

        container.onclick = fillCell;

        let mouseIsDown = false;

        container.onmousemove = (e) => {
            e.preventDefault();
            if (mouseIsDown) fillCell(e);
        };

        container.onmousedown = (e) => {
            e.preventDefault();
            mouseIsDown = true;
        };

        window.onmouseup = (e) => {
            e.preventDefault();
            mouseIsDown = false;
        };

        document.querySelector("#colorChooser").onchange = (e) => { color = e.target.value; };
        // Old
        //function fillCell(e) {
        //    let rect = container.getBoundingClientRect();
        //    let mouseX = e.clientX - rect.left;
        //    let mouseY = e.clientY - rect.top;
        //    let columnWidth = cellWidth + cellSpacing;
        //    let col = Math.floor(mouseX / columnWidth);
        //    let row = Math.floor(mouseY / columnWidth);
        //    let selectedCell = cells[row][col];
        //    selectedCell.className = 'cellSelected';
        //    selectedCell.style.backgroundColor = color;
        //    console.log(`${col}, ${row}`);
        //}

        // Life Stuff

        // Modded
        function fillCell(e) {
            debugger;
            if (!isPaused)
                return;
            let rect = container.getBoundingClientRect();
            let mouseX = e.clientX - rect.left;
            let mouseY = e.clientY - rect.top;
            let columnWidth = cellWidth + cellSpacing;
            let col = Math.floor(mouseX / columnWidth);
            let row = Math.floor(mouseY / columnWidth);
            let selectedCell = cells[row][col];
            if (color == "red")
                lifeworld.world[row][col] = 1;
            if (color == "white")
                lifeworld.world[row][col] = 0;
            //selectedCell.className = 'cellSelected';
            selectedCell.style.backgroundColor = color;
            console.log(`${col}, ${row}`);
        }

        let lastUpdate = performance.now();

        let lastFrame = performance.now();

        let maxFrameDelay = 1000 / 12;

        let isPaused = true;

        //document.querySelector("#stepButton").onclick = processFrame;
        document.querySelector("#pauseButton").onclick = (e) => {
            updateGrid();
            isPaused = !isPaused;
        };

        lifeworld.init(numCols, numRows);
        //debugger;
        loop(performance.now());

        function loop(timestamp) {
            requestAnimationFrame(loop);
            lastUpdate = timestamp;
            if (timestamp - lastFrame > maxFrameDelay) {
                lastFrame = timestamp;
                if (!isPaused) {
                    lifeworld.step();
                    updateGrid();
                }
            }
        }

        //function loop(timestamp) {
        //    if (isPaused)
        //        return;
        //    processFrame(timestamp);
        //}

        //function processFrame(timestamp) {
        //    requestAnimationFrame(loop);
        //    lastUpdate = timestamp;
        //    if (timestamp - lastFrame > maxFrameDelay) {
        //        lastFrame = timestamp;
        //        lifeworld.step();
        //        updateGrid();
        //    }
        //}

        function updateGrid() {
            for (let row = 0; row < numRows; row++) {
                for (let col = 0; col < numCols; col++) {
                    let element = cells[row][col];
                    if (lifeworld.world[row][col] == 1) {
                        element.style.backgroundColor = "red";
                    }
                    else {
                        element.style.backgroundColor = "white";
                    }
                }
            }
        }
    </script>-->
</body>
</html>